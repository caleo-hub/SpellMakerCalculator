<!DOCTYPE html>
<html lang="en" data-bs-theme="auto">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- SEO básico -->
  <title>Oblivion SpellMaker Calculator – Magic School Skills & Builder</title>
  <meta name="description"
        content="Instant web tool to craft and optimize custom spells for The Elder Scrolls IV: Oblivion. Magic School Skills, Spell Builder & Spell Stats in one responsive PWA-ready interface." />
  <meta name="keywords" content="Oblivion, SpellMaker, Spell Calculator, Magic School, Spell Builder" />
  <link rel="canonical" href="https://your-domain.com/" />

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />

  <!-- Seu CSS -->
  <link rel="stylesheet" href="assets/css/style.css" />

  <!-- Dark/Light mode automático -->
  <script>
    (function() {
      const userPref   = localStorage.getItem('theme');
      const systemPref = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
      document.documentElement.setAttribute('data-bs-theme', userPref || systemPref);
    })();
  </script>
</head>

<body class="container py-4">
  <header class="mb-5">
    <h1 class="display-6">Magic School Skills</h1>
    <p class="text-muted">Craft and manage your custom Oblivion spells instantly.</p>
  </header>

  <main>
    <!-- Skills Table -->
    <section class="mb-5">
      <button class="btn btn-outline-primary mb-3"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#skillsTable"
              aria-expanded="true"
              aria-controls="skillsTable">
        Toggle Skills Table
      </button>
      <div class="table-responsive">
        <h2 class="h5 mb-3">Skills Table</h2>
        <table class="table table-bordered align-middle text-center">
          <thead class="table-light">
            <tr>
              <th>School</th>
              <th>Level</th>
            </tr>
          </thead>
          <tbody id="skillsTable" class="collapse show">
            <!-- Populado por skillTable.js -->
          </tbody>
        </table>
      </div>
    </section>

    <!-- Spell Builder -->
    <section class="mb-5">
      <h2 class="h5 mb-3">Spell Builder</h2>
      <div id="spellBuilderContainer" class="spell-builder-container"></div>
    </section>

    <!-- Spell Stats -->
    <section class="mb-5">
      <h2 class="h5 mb-3">Spell Stats</h2>
      <div id="spellStatsContainer"></div>
    </section>
  </main>

  <aside class="my-5 text-center">
    <!-- AD SLOT: coloque aqui seu script de AdSense ou HTML de banner -->
  </aside>

  <footer class="text-center text-muted py-4 small">
    <p class="mb-1">&copy; 2025 SpellMaker Calculator — A fan project for the Elder Scrolls community.</p>
    <p class="mb-1">Not affiliated with or endorsed by Bethesda Softworks or ZeniMax Media.</p>
    <p>
      <a href="/privacy.html">Privacy Policy</a> •
      <a href="/terms.html">Terms of Use</a>
    </p>
  </footer>

  <!-- Bootstrap Bundle (JS + Popper) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Lógica em module: importa tudo que precisamos e dispara recálculo automático -->
  <script type="module">
    import { createSpellBuilderTable } from './assets/js/spellBuilder.js';
    import { initializeSpellStats, updateSpellStats } from './assets/js/spellStats.js';
    import { createSkillTable } from './assets/js/skillTable.js';

    // 1. Monta Skill Table
    createSkillTable(
      ['Alteration','Conjuration','Destruction','Illusion','Mysticism','Restoration','Luck'],
      'skillsTable'
    );

    // 2. Monta Spell Builder
    await createSpellBuilderTable("spellBuilderContainer","data/spells.json");

    // 3. Inicializa Spell Stats (estrutura vazia)
    initializeSpellStats("spellStatsContainer");

    // 4. Dispara cálculo inicial
    updateSpellStats();

    // 5. Observers para recálculo automático
    const builder = document.getElementById("spellBuilderContainer");
    const skills  = document.getElementById("skillsTable");

    // Sempre que adicionar/remover linhas:
    new MutationObserver(() => updateSpellStats())
      .observe(builder, { childList: true, subtree: true });
    new MutationObserver(() => updateSpellStats())
      .observe(skills, { childList: true, subtree: true });

    // Sempre que mudar valor em inputs ou selects:
    [builder, skills].forEach(container => {
      container.addEventListener("input",  () => updateSpellStats());
      container.addEventListener("change", () => updateSpellStats());
    });
  </script>
</body>
</html>
